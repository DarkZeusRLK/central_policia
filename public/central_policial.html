<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Intranet Policial | REVOADA RJ</title>
  <link rel="shortcut icon" href="images/Logo_policia.png" type="image/x-icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="../style/main.css">
  <style>
    body {
      display: flex;
      min-height: 100vh;
      background-color: #0f172a;
      overflow-x: hidden;
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    /* Sidebar Lateral */
    .sidebar {
      width: 260px;
      background: #1e293b;
      border-right: 1px solid rgba(255, 255, 255, 0.05);
      display: flex;
      flex-direction: column;
      position: fixed;
      height: 100%;
      z-index: 1000;
    }

    .sidebar-header {
      padding: 2rem;
      text-align: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      flex-shrink: 0;
    }

    .sidebar-header i {
      font-size: 2.5rem;
      color: var(--accent-gold);
      margin-bottom: 10px;
    }

    .sidebar-header h2 {
      color: white;
      font-size: 1.2rem;
      margin: 0;
    }

    .sidebar-menu {
      list-style: none;
      padding: 20px 0;
      flex: 1;
      overflow-y: auto;
    }

    .sidebar-menu::-webkit-scrollbar {
      width: 5px;
    }

    .sidebar-menu::-webkit-scrollbar-thumb {
      background: #334155;
      border-radius: 5px;
    }

    .sidebar-section-title {
      font-size: 0.7rem;
      text-transform: uppercase;
      color: #64748b;
      padding: 15px 25px 5px 25px;
      font-weight: bold;
      letter-spacing: 1px;
    }

    .sidebar-menu li a {
      display: flex;
      align-items: center;
      padding: 12px 25px;
      color: #94a3b8;
      text-decoration: none;
      transition: 0.2s;
      font-weight: 500;
      gap: 12px;
      font-size: 0.95rem;
    }

    .sidebar-menu li a:hover,
    .sidebar-menu li a.active {
      background: rgba(251, 191, 36, 0.05);
      color: var(--accent-gold);
      border-right: 3px solid var(--accent-gold);
    }

    .user-mini-profile {
      padding: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.05);
      display: flex;
      align-items: center;
      gap: 10px;
      color: white;
      flex-shrink: 0;
      background: #1e293b;
    }

    /* Conteúdo Principal */
    .dashboard-content {
      margin-left: 260px;
      flex: 1;
      padding: 40px;
      width: 100%;
    }

    /* Header do Dashboard com Sistema Online */
    .dashboard-header {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .system-status {
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(16, 185, 129, 0.1);
      padding: 10px 20px;
      border-radius: 8px;
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .pulsing-dot {
      width: 10px;
      height: 10px;
      background-color: #10b981;
      border-radius: 50%;
      box-shadow: 0 0 10px #10b981;
      animation: pulse 2s infinite;
    }

    .status-text {
      font-size: 0.85rem;
      letter-spacing: 2px;
      color: #10b981;
      font-weight: 600;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
        transform: scale(1);
      }

      50% {
        opacity: 0.7;
        transform: scale(1.1);
      }
    }

    .dash-section {
      display: none;
      animation: fadeIn 0.4s ease;
    }

    .dash-section:not(.hidden) {
      display: block;
    }

    /* --- NOVOS ESTILOS: GRID DASHBOARD --- */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .widget-card {
      background: #1e293b;
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 20px;
      display: flex;
      flex-direction: column;
    }

    .widget-title {
      color: var(--accent-gold);
      font-size: 1.1rem;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      padding-bottom: 10px;
    }

    /* Estilo Ranking */
    .ranking-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .ranking-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.03);
      color: #e2e8f0;
    }

    .ranking-item:last-child {
      border-bottom: none;
    }

    .rank-pos {
      font-weight: bold;
      width: 30px;
    }

    .rank-1 {
      color: #FFD700;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.4);
    }

    .rank-2 {
      color: #C0C0C0;
    }

    .rank-3 {
      color: #CD7F32;
    }

    .rank-name {
      flex: 1;
      margin-left: 10px;
    }

    .rank-score {
      background: rgba(255, 255, 255, 0.1);
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 0.85rem;
    }

    /* Estilo Última Notícia */
    .news-widget-content {
      position: relative;
      height: 200px;
      border-radius: 8px;
      overflow: hidden;
      display: flex;
      align-items: flex-end;
      background-size: cover;
      background-position: center;
    }

    .news-overlay {
      background: linear-gradient(to top, rgba(0, 0, 0, 0.9), transparent);
      width: 100%;
      padding: 15px;
      color: white;
    }

    /* Cards de Cursos */
    .course-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .course-card {
      background: #1e293b;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid #334155;
      transition: 0.3s;
      display: flex;
      flex-direction: column;
    }

    .course-card:hover {
      transform: translateY(-5px);
      border-color: var(--accent-gold);
    }

    /* Estilo especial para o curso restrito */
    .course-card.special {
      border: 1px solid #10b981;
      box-shadow: 0 0 15px rgba(16, 185, 129, 0.1);
    }

    .course-card.special .course-thumb {
      background: linear-gradient(45deg, #064e3b, #0f172a);
      color: #34d399;
    }

    .course-thumb {
      height: 160px;
      background: #0f172a;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #475569;
    }

    .course-body {
      padding: 20px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .course-body h3 {
      color: white;
      margin-bottom: 10px;
      font-size: 1.1rem;
    }

    .course-body p {
      color: #94a3b8;
      font-size: 0.9rem;
      margin-bottom: 15px;
      flex: 1;
    }

    .course-actions {
      margin-top: auto;
      padding-top: 15px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    /* Botão Canva (Roxo) */
    .btn-canva {
      background: linear-gradient(45deg, #7e22ce, #a855f7);
      color: white;
      padding: 8px 15px;
      border-radius: 6px;
      text-decoration: none;
      font-size: 0.85rem;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      transition: 0.2s;
    }

    .btn-canva:hover {
      filter: brightness(1.2);
    }

    /* Botão Video (Azul) */
    .btn-video {
      background: linear-gradient(45deg, #2563eb, #3b82f6);
      color: white;
      padding: 8px 15px;
      border-radius: 6px;
      text-decoration: none;
      font-size: 0.85rem;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      transition: 0.2s;
    }

    .btn-video:hover {
      filter: brightness(1.2);
    }

    /* Estilos do Formulário de Notícias */
    .form-dark-input {
      width: 100%;
      padding: 12px;
      background: #0f172a;
      border: 1px solid #334155;
      color: white;
      border-radius: 8px;
      margin-top: 5px;
      font-family: inherit;
    }

    .form-dark-input:focus {
      border-color: var(--accent-gold);
      outline: none;
    }

    .glass-panel {
      background: #1e293b;
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 30px;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .sidebar-logo {
      width: 80px;
      height: auto;
      margin-bottom: 15px;
      object-fit: contain;
      filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.3));
    }

    /* Estilo da Lista de Selecionados (Igual Código Penal) */
    .selected-list-container {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 10px;
      max-height: 200px;
      overflow-y: auto;
      padding-right: 5px;
    }

    .selected-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(30, 41, 59, 0.7);
      /* Cor escura translúcida */
      border: 1px solid #334155;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 0.9rem;
      color: #e2e8f0;
      transition: all 0.2s ease;
    }

    .selected-item:hover {
      border-color: var(--accent-gold);
      background: rgba(30, 41, 59, 1);
    }

    .selected-item span {
      font-weight: 500;
    }

    .btn-remove-item {
      background: transparent;
      border: none;
      color: #ef4444;
      /* Vermelho */
      cursor: pointer;
      font-size: 1rem;
      padding: 0 5px;
      transition: color 0.2s;
    }

    .btn-remove-item:hover {
      color: #ff6b6b;
    }

    /* Scrollbar fina para a lista */
    .selected-list-container::-webkit-scrollbar {
      width: 5px;
    }

    .selected-list-container::-webkit-scrollbar-thumb {
      background: #475569;
      border-radius: 3px;
    }
  </style>
</head>

<body>

  <aside class="sidebar">
    <div class="sidebar-header">
      <img src="images/Logo_policia.png" alt="Logo Polícia" class="sidebar-logo">
      <h2>INTRANET<br>POLICIAL</h2>
    </div>

    <ul class="sidebar-menu">
      <li><a href="#" onclick="switchTab('home', this)" class="active"><i class="fa-solid fa-gauge-high"></i> Painel Operacional</a></li>

      <li class="sidebar-section-title">DEPARTAMENTOS</li>
      <li><a href="departamentopcerj.html"><i class="fa-solid fa-magnifying-glass"></i> PCERJ</a></li>
      <li><a href="batalhaopmerj.html"><i class="fa-solid fa-person-military-rifle"></i> PMERJ</a></li>
      <li><a href="departamentoprf.html"><i class="fa-solid fa-road"></i> PRF</a></li>
      <li><a href="departamentopf.html"><i class="fa-solid fa-building-shield"></i> PF</a></li>

      <li class="sidebar-section-title">SERVIÇOS</li>
      <li><a href="../index.html#boletim"><i class="fa-solid fa-clipboard"></i> Registrar B.O.</a></li>

      <li class="sidebar-section-title">INTERNO</li>
      <li><a href="#" onclick="switchTab('cursos', this)"><i class="fa-solid fa-graduation-cap"></i> Cursos e Treinamentos</a></li>
      <li id="tab-instrutor" class="hidden">
        <a href="#" onclick="switchTab('instrutor', this)"><i class="fa-solid fa-chalkboard-user"></i> Área do Instrutor</a>
      </li>
      <li id="tab-jornalista" class="hidden">
        <a href="#" onclick="switchTab('jornalistas', this)"><i class="fa-solid fa-camera"></i> Área Jornalista</a>
      </li>

      <li style="margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.05);">
        <a href="../index.html"><i class="fa-solid fa-power-off"></i> Sair / Voltar ao Início</a>
      </li>
    </ul>

    <div class="user-mini-profile" id="sidebar-user">
    </div>
  </aside>

  <main class="dashboard-content">

    <div class="dashboard-header">
      <div class="system-status">
        <span class="pulsing-dot"></span>
        <span class="status-text">SISTEMA ONLINE</span>
      </div>
    </div>

    <section id="sec-home" class="dash-section">
      <h1 style="color: white; margin-bottom: 10px;">Painel Operacional</h1>
      <p style="color: #94a3b8;">Bem-vindo à área restrita, oficial.</p>

      <div style="margin-top: 20px; background: rgba(251, 191, 36, 0.1); padding: 20px; border-radius: 12px; border-left: 5px solid var(--accent-gold);">
        <h4 style="color: var(--accent-gold); margin: 0;"><i class="fa-solid fa-triangle-exclamation"></i> Aviso do Comando</h4>
        <p style="color: #cbd5e1; margin-top: 5px; font-size: 0.9rem;">Lembre-se de entrar na call de patrulha do Discord antes de iniciar o patrulhamento. O uso desta intranet é monitorado.</p>
      </div>

      <div class="dashboard-grid">
        <div class="widget-card">
          <div class="widget-title">
            <i class="fa-regular fa-newspaper"></i> Último Informativo
          </div>
          <div id="latest-news-container">
            <p style="color: #64748b; font-size: 0.9rem;">Buscando notícias...</p>
          </div>
        </div>
      </div>
    </section>

    <section id="sec-cursos" class="dash-section hidden">
      <h1 style="color: white;">Cursos de Formação</h1>
      <p style="color: #94a3b8;">Acervo de treinamentos, procedimentos operacionais e táticas especiais.</p>

      <div class="course-grid">

        <div class="course-card">
          <div class="course-thumb"><i class="fa-solid fa-person-military-to-person fa-3x"></i></div>
          <div class="course-body">
            <h3>Conduta Policial e Ordem Unida</h3>
            <p>Fundamentos de hierarquia, disciplina, postura e ética militar.</p>
            <div class="course-actions">
              <a href="https://www.canva.com/design/DAGRhQ_rnd0/dwHksmqhwl9ke3UuI5vtsA/view?utm_content=DAGRhQ_rnd0&utm_campaign=designshare&utm_medium=link2&utm_source=uniquelinks&utlId=h8d9761429b" class="btn-canva" target="_blank"><i class="fa-solid fa-paintbrush"></i> Canva</a>
              <a href="#" class="btn-video" target="_blank"><i class="fa-solid fa-play"></i> Vídeo</a>
            </div>
          </div>
        </div>

        <div class="course-card">
          <div class="course-thumb"><i class="fa-solid fa-headset fa-3x"></i></div>
          <div class="course-body">
            <h3>Patrulha e Modulação</h3>
            <p>Táticas de patrulhamento ostensivo, abordagem segura e códigos Q de rádio.</p>
            <div class="course-actions">
              <a href="https://www.canva.com/design/DAGRh2LRNf8/yexVocdAQDrfeUQe7hiF1A/view?utm_content=DAGRh2LRNf8&utm_campaign=designshare&utm_medium=link2&utm_source=uniquelinks&utlId=h918f53b86d" class="btn-canva" target="_blank"><i class="fa-solid fa-paintbrush"></i> Canva</a>
              <a href="#" class="btn-video" target="_blank"><i class="fa-solid fa-play"></i> Vídeo</a>
            </div>
          </div>
        </div>

        <div class="course-card">
          <div class="course-thumb"><i class="fa-solid fa-magnifying-glass-chart fa-3x"></i></div>
          <div class="course-body">
            <h3>Detecção de Ilícitos</h3>
            <p>Identificação de substâncias, armas modificadas e procedimento de revista.</p>
            <div class="course-actions">
              <a href="https://www.canva.com/design/DAGOV3IRpSg/aKhf4QFYWvsAUfr3pJLeGw/view?utm_content=DAGOV3IRpSg&utm_campaign=designshare&utm_medium=link2&utm_source=uniquelinks&utlId=ha36c6be472" class="btn-canva" target="_blank"><i class="fa-solid fa-paintbrush"></i> Canva</a>
              <a href="#" class="btn-video" target="_blank"><i class="fa-solid fa-play"></i> Vídeo</a>
            </div>
          </div>
        </div>

        <div class="course-card">
          <div class="course-thumb"><i class="fa-solid fa-lock fa-3x"></i></div>
          <div class="course-body">
            <h3>Curso de Carcereiro</h3>
            <p>Gestão prisional, transporte de detentos e segurança de celas.</p>
            <div class="course-actions">
              <a href="https://www.canva.com/design/DAGRn3OJX0k/ilPz5PQ2t-X7MYpQDGNILQ/view?utm_content=DAGRn3OJX0k&utm_campaign=designshare&utm_medium=link2&utm_source=uniquelinks&utlId=he2667444d4" class="btn-canva" target="_blank"><i class="fa-solid fa-paintbrush"></i> Canva</a>
              <a href="#" class="btn-video" target="_blank"><i class="fa-solid fa-play"></i> Vídeo</a>
            </div>
          </div>
        </div>

        <div class="course-card special restricted-card hidden" style="display: none;">
          <div class="course-thumb" style="background: linear-gradient(45deg, #0f172a, #1e293b); color: #34d399;">
            <i class="fa-solid fa-fingerprint fa-3x"></i>
          </div>
          <div class="course-body">
            <h3 style="color: #34d399;">Perícia Criminal</h3>
            <p>Investigação forense, coleta de evidências, análise de cena de crime e balística.</p>
            <div class="course-actions">
              <a href="https://www.canva.com/design/DAG7El5Msxs/9FBsRvWN31WRkI7rpuBv1A/view?utm_content=DAG7El5Msxs&utm_campaign=designshare&utm_medium=link2&utm_source=uniquelinks&utlId=h40ebc27c70" class="btn-canva" target="_blank"><i class="fa-solid fa-paintbrush"></i> Canva</a>
              <a href="#" class="btn-video" target="_blank"><i class="fa-solid fa-play"></i> Vídeo</a>
            </div>
          </div>
        </div>

        <div class="course-card special restricted-card hidden" style="display: none;">
          <div class="course-thumb" style="background: linear-gradient(45deg, #3f1010, #0f172a); color: #f87171;">
            <i class="fa-solid fa-mask fa-3x"></i>
          </div>
          <div class="course-body">
            <h3 style="color: #f87171;">Combate ao Tráfico</h3>
            <p>Operações de DTE, inteligência, invasão tática e interceptação de cargas.</p>
            <div class="course-actions">
              <a href="https://www.canva.com/design/DAGLi_wnHfQ/tSE-MWF0EXdBjqYwAUw30A/view?utm_content=DAGLi_wnHfQ&utm_campaign=designshare&utm_medium=link2&utm_source=uniquelinks&utlId=hcc06bf7006" class="btn-canva" target="_blank"><i class="fa-solid fa-paintbrush"></i> Canva</a>
              <a href="#" class="btn-video" target="_blank"><i class="fa-solid fa-play"></i> Vídeo</a>
            </div>
          </div>
        </div>

      </div>
    </section>
    <section id="sec-instrutor" class="dash-section hidden">

      <!-- CABEÇALHO -->
      <div style="margin-bottom: 20px;">
        <h1 style="color: white; font-size: 1.5rem; margin-bottom: 5px;">
          <i class="fa-solid fa-chalkboard-user"></i> Gestão de Cursos
        </h1>
        <p style="color: #94a3b8; font-size: 0.9rem;">
          Ferramenta exclusiva para instrutores e comando.
        </p>
      </div>

      <!-- FILTRO DE TIPO DE CURSO (NOVO) -->
      <div class="form-group" style="margin-bottom: 20px; max-width: 350px;">
        <label style="color: #cbd5e1; font-size: 0.85rem; display: block; margin-bottom: 5px;">
          Tipo de Curso
        </label>
        <select id="filtro-tipo-curso" class="form-dark-input" style="width: 100%; padding: 10px; background: #1e293b; border: 1px solid #334155; color: white; border-radius: 6px;">
          <option value="basico">Cursos Básicos</option>
          <option value="complementar">Cursos Complementares</option>
          <option value="acoes">Cursos de Ações</option>
        </select>
      </div>

      <!-- DATALIST DISCORD -->
      <datalist id="lista-membros-discord"></datalist>

      <!-- BOTÕES DE TABS -->
      <div style="display: flex; gap: 10px; margin-bottom: 25px;">
        <button onclick="toggleInstrutorTab('relatorio')" class="btn-primary" style="background: var(--accent-gold); color: #0f172a; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; flex: 1;">
          <i class="fa-solid fa-file-signature"></i> Relatório Final
        </button>

        <button onclick="toggleInstrutorTab('anuncio')" class="btn-primary" style="background: #334155; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; flex: 1;">
          <i class="fa-solid fa-bullhorn"></i> Anunciar Curso
        </button>
      </div>

      <!-- RELATÓRIO -->
      <div id="instrutor-relatorio" class="glass-panel" style="max-width: 100%;">

        <h3 style="color: var(--accent-gold); margin-bottom: 20px; border-bottom: 1px solid #334155; padding-bottom: 10px;">
          Emitir Relatório de Curso Finalizado
        </h3>

        <form id="form-curso-final" onsubmit="handleCourseSubmit(event, 'final')">

          <div class="form-group" style="margin-bottom: 15px;">
            <label style="color: #cbd5e1; font-size: 0.85rem; display: block; margin-bottom: 5px;">
              Curso Ministrado
            </label>
            <select name="curso_nome" class="form-dark-input" style="width: 100%; padding: 10px; background: #1e293b; border: 1px solid #334155; color: white; border-radius: 6px;" required>
              <option value="" disabled selected>Carregando lista de cursos...</option>
            </select>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
            <div class="form-group">
              <label style="color: #cbd5e1; font-size: 0.85rem; margin-bottom: 5px; display: block;">
                Início
              </label>
              <div style="display: flex; gap: 5px;">
                <input type="date" name="data_inicio" class="form-dark-input" style="background: #1e293b; border: 1px solid #334155; color: white; padding: 8px; border-radius: 6px; flex: 2;" required>
                <input type="time" name="hora_inicio" class="form-dark-input" style="background: #1e293b; border: 1px solid #334155; color: white; padding: 8px; border-radius: 6px; flex: 1;" required>
              </div>
            </div>

            <div class="form-group">
              <label style="color: #cbd5e1; font-size: 0.85rem; margin-bottom: 5px; display: block;">
                Fim
              </label>
              <div style="display: flex; gap: 5px;">
                <input type="date" name="data_fim" class="form-dark-input" style="background: #1e293b; border: 1px solid #334155; color: white; padding: 8px; border-radius: 6px; flex: 2;" required>
                <input type="time" name="hora_fim" class="form-dark-input" style="background: #1e293b; border: 1px solid #334155; color: white; padding: 8px; border-radius: 6px; flex: 1;" required>
              </div>
            </div>
          </div>

          <!-- INSTRUTORES -->
          <div class="form-group" style="margin-bottom: 15px;">
            <label style="color: #60a5fa; font-size: 0.85rem; margin-bottom: 5px; display: block;">
              Instrutores Responsáveis
            </label>
            <div style="display: flex; gap: 5px;">
              <input type="text" id="input-instrutores" list="lista-membros-discord" class="form-dark-input" placeholder="Digite o nome..." style="flex: 1; background: #1e293b; border: 1px solid #334155; color: white; padding: 10px; border-radius: 6px;" onkeypress="checarEnter(event, 'instrutores')">
              <button type="button" onclick="adicionarMembroManual('instrutores')" style="background: #3b82f6; color: white; border: none; border-radius: 6px; width: 40px; cursor: pointer;">
                <i class="fa-solid fa-plus"></i>
              </button>
            </div>
            <div id="visual-instrutores" class="selected-list-container"></div>
            <input type="hidden" name="instrutores" id="hidden-instrutores">
          </div>

          <!-- AUXILIARES -->
          <div class="form-group" style="margin-bottom: 15px;">
            <label style="color: #94a3b8; font-size: 0.85rem; margin-bottom: 5px; display: block;">
              Auxiliares (Opcional)
            </label>
            <div style="display: flex; gap: 5px;">
              <input type="text" id="input-auxiliares" list="lista-membros-discord" class="form-dark-input" placeholder="Digite o nome..." style="flex: 1; background: #1e293b; border: 1px solid #334155; color: white; padding: 10px; border-radius: 6px;" onkeypress="checarEnter(event, 'auxiliares')">
              <button type="button" onclick="adicionarMembroManual('auxiliares')" style="background: #475569; color: white; border: none; border-radius: 6px; width: 40px; cursor: pointer;">
                <i class="fa-solid fa-plus"></i>
              </button>
            </div>
            <div id="visual-auxiliares" class="selected-list-container"></div>
            <input type="hidden" name="auxiliares" id="hidden-auxiliares">
          </div>

          <!-- APROVADOS / REPROVADOS -->
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
            <div>
              <label style="color: #4ade80; font-size: 0.85rem; margin-bottom: 5px; display: block;">
                ✅ Aprovados
              </label>
              <div style="display: flex; gap: 5px;">
                <input type="text" id="input-aprovados" list="lista-membros-discord" class="form-dark-input" placeholder="Adicionar..." style="flex: 1; background: #1e293b; border: 1px solid #334155; color: white; padding: 10px; border-radius: 6px;" onkeypress="checarEnter(event, 'aprovados')">
                <button type="button" onclick="adicionarMembroManual('aprovados')" style="background: #15803d; color: white; border: none; border-radius: 6px; width: 40px; cursor: pointer;">
                  <i class="fa-solid fa-plus"></i>
                </button>
              </div>
              <div id="visual-aprovados" class="selected-list-container"></div>
              <input type="hidden" name="aprovados" id="hidden-aprovados">
            </div>

            <div>
              <label style="color: #f87171; font-size: 0.85rem; margin-bottom: 5px; display: block;">
                ❌ Reprovados
              </label>
              <div style="display: flex; gap: 5px;">
                <input type="text" id="input-reprovados" list="lista-membros-discord" class="form-dark-input" placeholder="Adicionar..." style="flex: 1; background: #1e293b; border: 1px solid #334155; color: white; padding: 10px; border-radius: 6px;" onkeypress="checarEnter(event, 'reprovados')">
                <button type="button" onclick="adicionarMembroManual('reprovados')" style="background: #b91c1c; color: white; border: none; border-radius: 6px; width: 40px; cursor: pointer;">
                  <i class="fa-solid fa-plus"></i>
                </button>
              </div>
              <div id="visual-reprovados" class="selected-list-container"></div>
              <input type="hidden" name="reprovados" id="hidden-reprovados">
            </div>
          </div>

          <!-- OBS -->
          <div class="form-group" style="margin-bottom: 20px;">
            <label style="color: #cbd5e1; font-size: 0.85rem; margin-bottom: 5px; display: block;">
              Observações
            </label>
            <textarea name="obs" rows="3" class="form-dark-input" placeholder="Ocorrências relevantes..." style="width: 100%; background: #1e293b; border: 1px solid #334155; color: white; padding: 10px; border-radius: 6px; resize: vertical;"></textarea>
            <small style="color: #64748b; font-size: 0.75rem;">
              *As Matrizes serão notificadas automaticamente no canal geral.
            </small>
          </div>

          <button type="submit" class="btn-primary" style="width: 100%; padding: 12px; background: var(--accent-gold); color: #0f172a; font-weight: bold; border: none; border-radius: 8px; cursor: pointer;">
            <i class="fa-solid fa-paper-plane"></i> ENVIAR RELATÓRIO
          </button>

        </form>
      </div>

      <!-- ANÚNCIO -->
      <div id="instrutor-anuncio" class="glass-panel hidden" style="max-width: 800px;">

        <h3 style="color: white; margin-bottom: 15px;">
          Anunciar Novo Curso
        </h3>

        <form id="form-curso-anuncio" onsubmit="handleCourseSubmit(event, 'anuncio')">

          <div class="form-grid" style="display: grid; gap: 15px;">

            <div class="form-group">
              <label style="color: #cbd5e1;">Curso a ser aplicado</label>
              <select name="curso_nome" class="form-dark-input" style="width: 100%; padding: 10px; background: #1e293b; border: 1px solid #334155; color: white; border-radius: 6px;" required>
                <option value="" disabled selected>Carregando lista...</option>
              </select>
            </div>

            <div class="form-group">
              <label style="color: #cbd5e1;">Instrutor Responsável</label>
              <input type="text" name="instrutores" list="lista-membros-discord" class="form-dark-input" style="width: 100%; padding: 10px; background: #1e293b; border: 1px solid #334155; color: white; border-radius: 6px;" required placeholder="Busque seu nome...">
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
              <div>
                <label style="color: #cbd5e1;">Data</label>
                <input type="date" name="data" class="form-dark-input" style="width: 100%; padding: 10px; background: #1e293b; border: 1px solid #334155; color: white; border-radius: 6px;" required>
              </div>
              <div>
                <label style="color: #cbd5e1;">Horário</label>
                <input type="time" name="horario" class="form-dark-input" style="width: 100%; padding: 10px; background: #1e293b; border: 1px solid #334155; color: white; border-radius: 6px;" required>
              </div>
            </div>

            <div class="form-group">
              <label style="color: #cbd5e1;">Local da Formação</label>
              <input type="text" name="local" class="form-dark-input" style="width: 100%; padding: 10px; background: #1e293b; border: 1px solid #334155; color: white; border-radius: 6px;" placeholder="Ex: Sala de Aula 1">
            </div>

            <div class="form-group">
              <label style="color: #cbd5e1;">Link da Call (Discord)</label>
              <input type="url" name="call_link" class="form-dark-input" style="width: 100%; padding: 10px; background: #1e293b; border: 1px solid #334155; color: white; border-radius: 6px;" placeholder="https://discord.com/channels/...">
            </div>

          </div>

          <button type="submit" class="btn-primary" style="margin-top: 20px; width: 100%; padding: 12px; background: #3b82f6; color: white; font-weight: bold; border: none; border-radius: 8px; cursor: pointer;">
            <i class="fa-solid fa-bullhorn"></i> Publicar Anúncio
          </button>

        </form>
      </div>

    </section>

    <section id="sec-jornalistas" class="dash-section hidden">
      <h1 style="color: white;"><i class="fa-solid fa-newspaper"></i> Sala de Imprensa</h1>
      <p style="color: #94a3b8;">Área exclusiva para redação e mídia.</p>

      <div class="glass-panel" style="margin-top: 20px; max-width: 800px;">
        <h3 style="color: var(--accent-gold); margin-bottom: 20px;">
          <i class="fa-solid fa-pen-nib"></i> Criar Nova Matéria
        </h3>

        <form id="form-news">
          <div style="margin-bottom: 15px;">
            <label style="color: #cbd5e1; font-size: 0.9rem;">Manchete da Notícia</label>
            <input type="text" name="title" required placeholder="Ex: Grande operação apreende cargas na Zona Norte" class="form-dark-input">
          </div>

          <div style="margin-bottom: 15px;">
            <label style="color: #cbd5e1; font-size: 0.9rem;">Link da Imagem (URL)</label>
            <input type="url" name="imageUrl" required placeholder="https://..." class="form-dark-input">
          </div>

          <div style="margin-bottom: 15px;">
            <label style="color: #cbd5e1; font-size: 0.9rem;">Tipo de Fonte do Texto</label>
            <select name="fontFamily" id="fontFamily" class="form-dark-input" style="margin-top: 5px;">
              <option value="normal">Normal (Padrão)</option>
              <option value="bold">Negrito</option>
              <option value="italic">Itálico</option>
              <option value="bold-italic">Negrito e Itálico</option>
              <option value="code">Código/Monospace</option>
            </select>
          </div>

          <div style="margin-bottom: 20px;">
            <label style="color: #cbd5e1; font-size: 0.9rem;">Corpo da Notícia</label>
            <textarea name="content" id="newsContent" rows="6" required placeholder="Digite os detalhes da ocorrência aqui..." class="form-dark-input" style="font-family: inherit;"></textarea>
          </div>

          <button type="submit" class="btn-primary" style="width: 100%; padding: 12px; background: var(--accent-gold); color: #0f172a; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; transition: 0.3s;">
            <i class="fa-solid fa-paper-plane"></i> Publicar no Jornal
          </button>
        </form>
      </div>
    </section>

  </main>
  <script>
    /* ==========================================================================
       CONFIGURAÇÕES E ESTADO GLOBAL
       ========================================================================== */
    const ALLOWED_ROLE_IDS = ["1053687224320933888", "1447060519726088212"];
    let discordMembersMap = {};
    let allCursos = [];

    /* ==========================================================================
       NAVEGAÇÃO (SWITCH TAB)
       ========================================================================== */
    window.switchTab = function (sectionName, element) {
      document.querySelectorAll(".dash-section").forEach(sec => sec.classList.add("hidden"));

      const target = document.getElementById("sec-" + sectionName);
      if (target) target.classList.remove("hidden");
      else console.error("Seção não encontrada:", sectionName);

      if (element) {
        document.querySelectorAll(".sidebar-menu a").forEach(a => a.classList.remove("active"));
        element.classList.add("active");
      }
    };

    /* ==========================================================================
       NOTIFICAÇÕES (TOAST)
       ========================================================================== */
    const Notify = {
      container: null,

      init() {
        if (!document.querySelector(".notification-container")) {
          this.container = document.createElement("div");
          this.container.className = "notification-container";
          document.body.appendChild(this.container);
        } else {
          this.container = document.querySelector(".notification-container");
        }
      },

      show(message, type = "info") {
        if (!this.container) this.init();

        const toast = document.createElement("div");
        toast.className = `toast ${type}`;

        let icon = "fa-info-circle";
        if (type === "success") icon = "fa-check-circle";
        if (type === "error") icon = "fa-exclamation-triangle";
        if (type === "loading") icon = "fa-spinner fa-spin";

        toast.innerHTML = `<i class="fas ${icon}"></i><span>${message}</span>`;
        this.container.appendChild(toast);

        if (type !== "loading") {
          setTimeout(() => {
            toast.style.animation = "slideIn .3s reverse forwards";
            setTimeout(() => toast.remove(), 300);
          }, 4000);
        }
      },

      success(msg) { this.show(msg, "success"); },
      error(msg) { this.show(msg, "error"); },
      loading(msg) { this.show(msg, "loading"); }
    };

    /* ==========================================================================
       INICIALIZAÇÃO
       ========================================================================== */
    document.addEventListener("DOMContentLoaded", () => {
      Notify.init();

      const userJson = localStorage.getItem("revoada_user");
      if (!userJson) {
        window.location.href = "../index.html";
        return;
      }

      const user = JSON.parse(userJson);

      renderSidebarUser(user);
      checkSpecialPermissions(user);
      loadDashboardData();
      setupNewsForm(user);
      checkInstrutorPermission(user);
      setupCourseFilter();
    });

    /* ==========================================================================
       SIDEBAR / PERMISSÕES
       ========================================================================== */
    function renderSidebarUser(user) {
      const sidebarUser = document.getElementById("sidebar-user");
      if (!sidebarUser) return;

      sidebarUser.innerHTML = `
    <img src="https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png"
         style="width:40px;height:40px;border-radius:50%;">
    <div>
      <div style="font-weight:bold;font-size:.9rem;">${user.username}</div>
      <div style="font-size:.75rem;color:#64748b;">Online</div>
    </div>
  `;
    }

    function checkSpecialPermissions(user) {
      if (localStorage.getItem("revoada_is_journalist") === "true") {
        document.getElementById("tab-jornalista")?.classList.remove("hidden");
      }

      if (user.roles && user.roles.some(r => ALLOWED_ROLE_IDS.includes(String(r)))) {
        document.querySelectorAll(".restricted-card").forEach(c => {
          c.classList.remove("hidden");
          c.style.display = "flex";
        });
      }
    }

    /* ==========================================================================
       DASHBOARD
       ========================================================================== */
    async function loadDashboardData() {
      console.log("Dashboard inicializado.");
    }

    /* ==========================================================================
       FORMULÁRIO DE NOTÍCIAS
       ========================================================================== */
    function setupNewsForm(user) {
      const formNews = document.getElementById("form-news");
      if (!formNews) return;

      formNews.addEventListener("submit", async e => {
        e.preventDefault();

        const btn = formNews.querySelector("button");
        const originalText = btn.innerHTML;

        btn.disabled = true;
        btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Enviando...';

        const data = Object.fromEntries(new FormData(formNews).entries());
        data.author_name = user.username;
        data.author_avatar = user.avatar;
        data.author_id = user.id;

        try {
          const res = await fetch("/api/news", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
          });

          if (res.ok) {
            Notify.success("Notícia publicada com sucesso!");
            formNews.reset();
          } else {
            Notify.success("Notícia enviada (Simulação)");
            formNews.reset();
          }
        } catch (err) {
          Notify.error("Erro ao publicar notícia.");
          console.error(err);
        } finally {
          btn.disabled = false;
          btn.innerHTML = originalText;
        }
      });
    }

    /* ==========================================================================
       PERMISSÃO DE INSTRUTOR
       ========================================================================== */
    async function checkInstrutorPermission(user) {
      if (!user.roles) return;

      try {
        const res = await fetch("/api/course-manager?action=config");
        if (!res.ok) return;

        const config = await res.json();
        if (!config.instrutorRoleId) return;

        const allowed = config.instrutorRoleId.split(",").map(id => id.trim());
        if (user.roles.some(r => allowed.includes(String(r)))) {
          const tab = document.getElementById("tab-instrutor");
          if (tab) {
            tab.classList.remove("hidden");
            loadDiscordData();
          }
        }
      } catch (e) {
        console.error("Erro ao verificar permissão de instrutor:", e);
      }
    }

    /* ==========================================================================
       DADOS DO DISCORD
       ========================================================================== */
    async function loadDiscordData() {
      try {
        const res = await fetch("/api/course-manager?action=discord-data");
        if (!res.ok) throw new Error("Erro API Discord");

        const data = await res.json();

        allCursos = Array.isArray(data.cursos) ? data.cursos : [];
        renderCursosPorTipo(getTipoCursoSelecionado());

        const datalist = document.getElementById("lista-membros-discord");
        discordMembersMap = {};

        if (datalist) {
          datalist.innerHTML = "";
          data.membros.forEach(m => {
            discordMembersMap[m.name] = m.id;
            const opt = document.createElement("option");
            opt.value = m.name;
            datalist.appendChild(opt);
          });
        }
      } catch (e) {
        console.error("Falha ao carregar dados do Discord:", e);
      }
    }

    function setupCourseFilter() {
      const filtro = document.getElementById("filtro-tipo-curso");
      if (!filtro) return;

      filtro.addEventListener("change", () => {
        if (!allCursos.length) return;
        renderCursosPorTipo(filtro.value);
      });
    }

    function getTipoCursoSelecionado() {
      const filtro = document.getElementById("filtro-tipo-curso");
      return filtro ? filtro.value : "basico";
    }

    function renderCursosPorTipo(tipo) {
      const selects = document.querySelectorAll('select[name="curso_nome"]');
      if (!selects.length) return;

      const cursosFiltrados = allCursos.filter(curso => !curso.tipo || curso.tipo === tipo);
      const placeholderTexto = cursosFiltrados.length
        ? "Selecione o Curso..."
        : "Nenhum curso neste filtro";

      selects.forEach(sel => {
        sel.innerHTML = "";

        const placeholder = document.createElement("option");
        placeholder.value = "";
        placeholder.disabled = true;
        placeholder.selected = true;
        placeholder.textContent = placeholderTexto;
        sel.appendChild(placeholder);

        cursosFiltrados.forEach(curso => {
          const opt = document.createElement("option");
          opt.value = curso.id;
          opt.textContent = curso.name;
          sel.appendChild(opt);
        });
      });
    }

    /* ==========================================================================
       INTERAÇÃO VISUAL (LISTAS)
       ========================================================================== */
    window.formatarMençao = function () { };

    window.checarEnter = function (event, tipo) {
      if (event.key === "Enter") {
        event.preventDefault();
        adicionarMembroManual(tipo);
      }
    };

    window.adicionarMembroManual = function (tipo) {
      const input = document.getElementById(`input-${tipo}`);
      const container = document.getElementById(`visual-${tipo}`);
      if (!input || !container) return;

      const nome = input.value.trim();
      if (!nome) return;

      const idReal = discordMembersMap[nome];
      const valor = idReal ? `<@${idReal}>` : nome;

      const div = document.createElement("div");
      div.className = "selected-item";
      div.dataset.value = valor;

      div.innerHTML = `
    <span>${nome}</span>
    <button type="button" class="btn-remove-item"
            onclick="removerItem(this,'${tipo}')">
      <i class="fa-solid fa-trash"></i>
    </button>
  `;

      container.appendChild(div);
      atualizarHiddenInput(tipo);

      input.value = "";
      input.focus();
    };

    window.removerItem = function (btn, tipo) {
      btn.closest(".selected-item")?.remove();
      atualizarHiddenInput(tipo);
    };

    function atualizarHiddenInput(tipo) {
      const container = document.getElementById(`visual-${tipo}`);
      const hidden = document.getElementById(`hidden-${tipo}`);
      if (!container || !hidden) return;

      const valores = Array.from(container.querySelectorAll(".selected-item"))
        .map(el => el.dataset.value);

      hidden.value = valores.join(", ");
    }

    /* ==========================================================================
       TABS INSTRUTOR
       ========================================================================== */
    window.toggleInstrutorTab = function (t) {
      const relatorio = document.getElementById("instrutor-relatorio");
      const anuncio = document.getElementById("instrutor-anuncio");

      if (t === "relatorio") {
        relatorio.classList.remove("hidden");
        anuncio.classList.add("hidden");
      } else {
        relatorio.classList.add("hidden");
        anuncio.classList.remove("hidden");
      }
    };

    /* ==========================================================================
       ENVIO DE CURSO / ANÚNCIO
       ========================================================================== */
    window.handleCourseSubmit = async function (e, type) {
      e.preventDefault();

      Notify.loading("Processando envio...");

      const form = e.target;
      const btn = form.querySelector('button[type="submit"]');
      const originalText = btn.innerHTML;

      btn.disabled = true;
      btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Processando...';

      const data = Object.fromEntries(new FormData(form).entries());

      const cursoSelect = form.querySelector('select[name="curso_nome"]');
      if (cursoSelect && cursoSelect.selectedIndex >= 0) {
        data.curso_id = cursoSelect.value;
        data.curso_nome = cursoSelect.options[cursoSelect.selectedIndex].text;
      }

      data.type = type;

      const user = JSON.parse(localStorage.getItem("revoada_user"));
      data.authorId = user.id;
      data.userRoles = user.roles;

      try {
        const res = await fetch("/api/course-manager", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        if (res.ok) {
          Notify.success(type === "final"
            ? "Relatório enviado com sucesso!"
            : "Anúncio publicado!");

          form.reset();
          document.querySelectorAll(".selected-list-container").forEach(el => el.innerHTML = "");
          document.querySelectorAll('input[type="hidden"]').forEach(el => el.value = "");
        } else {
          const err = await res.json();
          throw new Error(err.error || "Erro desconhecido");
        }
      } catch (err) {
        Notify.error(err.message);
        console.error(err);
      } finally {
        btn.disabled = false;
        btn.innerHTML = originalText;
      }
    };
  </script>
</body>

</html>
